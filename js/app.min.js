/* Modified: October 9, 2014, 11:04:19 */
!function(){function a(a){d3.layout.cloud().size([e,f]).words(a).rotate(function(){return 90*~~(2*Math.random())}).font(g).fontSize(function(a){return a.size*h}).on("end",b).start()}function b(a){var b=j.selectAll("text").data(a);b.enter().append("text").style("font-size",function(a){return a.size+"px"}).style("font-family",function(a){return a.font}).style("fill",function(a,b){return i(b)}).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.text})}function c(){l.history({channel:k,count:100,callback:function(b){a(d(b[0]))}})}function d(a){if(a){a=a.join(" "),a=a.toLowerCase().replace(/object Object/g,"").replace(/[\+\.,\/#!$%\^&\*{}=_`~]/g,""),a=a.split(" ");for(var b={},c=0;c<a.length;c++)b[a[c]]||(b[a[c]]=0),b[a[c]]++;var d=[];for(var e in b)d.push({text:e,size:b[e]});return d}}var e=document.body.clientWidth,f=window.innerHeight-document.querySelector("header").clientHeight-40,g="Gorditas",h=24,i=d3.scale.category20b(),j=d3.select("#cloud").append("svg").attr("width",e).attr("height",f).append("g").attr("transform","translate("+e/2+", "+f/2+")"),k="chat",l=PUBNUB.init({subscribe_key:"sub-c-f762fb78-2724-11e4-a4df-02ee2ddab7fe",publish_key:"pub-c-156a6d5f-22bd-4a13-848d-b5b4d4b36695"});c()}(),function(){function a(){function a(a,b,c){for(var d,e,f,g=([{x:0,y:0},{x:m[0],y:m[1]}],b.x),h=b.y,j=Math.sqrt(m[0]*m[0]+m[1]*m[1]),l=w(m),n=Math.random()<.5?1:-1,o=-n;(d=l(o+=n))&&(e=~~d[0],f=~~d[1],!(Math.min(e,f)>j));)if(b.x=g+e,b.y=h+f,!(b.x+b.x0<0||b.y+b.y0<0||b.x+b.x1>m[0]||b.y+b.y1>m[1]||c&&i(b,a,m[0])||c&&!k(b,c))){for(var p,q=b.sprite,r=b.width>>5,s=m[0]>>5,t=b.x-(r<<4),u=127&t,v=32-u,x=b.y1-b.y0,y=(b.y+b.y0)*s+(t>>5),z=0;x>z;z++){p=0;for(var A=0;r>=A;A++)a[y+A]|=p<<v|(r>A?(p=q[z*r+A])>>>u:0);y+=s}return delete b.sprite,!0}return!1}var m=[256,256],o=b,p=c,q=e,r=d,s=d,t=f,v=g,w=l,x=[],y=1/0,z=d3.dispatch("word","end"),A=null,B={};return B.start=function(){function b(){for(var b,k=+new Date;+new Date-k<y&&++f<e&&A;)b=i[f],b.x=m[0]*(Math.random()+.5)>>1,b.y=m[1]*(Math.random()+.5)>>1,h(b,i,f),b.hasText&&a(c,b,d)&&(g.push(b),z.word(b),d?j(d,b):d=[{x:b.x+b.x0,y:b.y+b.y0},{x:b.x+b.x1,y:b.y+b.y1}],b.x-=m[0]>>1,b.y-=m[1]>>1);f>=e&&(B.stop(),z.end(g,d))}var c=n((m[0]>>5)*m[1]),d=null,e=x.length,f=-1,g=[],i=x.map(function(a,b){return a.text=o.call(this,a,b),a.font=p.call(this,a,b),a.style=r.call(this,a,b),a.weight=s.call(this,a,b),a.rotate=t.call(this,a,b),a.size=~~q.call(this,a,b),a.padding=v.call(this,a,b),a}).sort(function(a,b){return b.size-a.size});return A&&clearInterval(A),A=setInterval(b,0),b(),B},B.stop=function(){return A&&(clearInterval(A),A=null),B},B.timeInterval=function(a){return arguments.length?(y=null==a?1/0:a,B):y},B.words=function(a){return arguments.length?(x=a,B):x},B.size=function(a){return arguments.length?(m=[+a[0],+a[1]],B):m},B.font=function(a){return arguments.length?(p=d3.functor(a),B):p},B.fontStyle=function(a){return arguments.length?(r=d3.functor(a),B):r},B.fontWeight=function(a){return arguments.length?(s=d3.functor(a),B):s},B.rotate=function(a){return arguments.length?(t=d3.functor(a),B):t},B.text=function(a){return arguments.length?(o=d3.functor(a),B):o},B.spiral=function(a){return arguments.length?(w=u[a+""]||a,B):w},B.fontSize=function(a){return arguments.length?(q=d3.functor(a),B):q},B.padding=function(a){return arguments.length?(v=d3.functor(a),B):v},d3.rebind(B,z,"on")}function b(a){return a.text}function c(){return"serif"}function d(){return"normal"}function e(a){return Math.sqrt(a.value)}function f(){return 30*(~~(6*Math.random())-3)}function g(){return 1}function h(a,b,c){if(!a.sprite){t.clearRect(0,0,(q<<5)/s,r/s);var d=0,e=0,f=0,g=b.length;for(--c;++c<g;){a=b[c],t.save(),t.font=a.style+" "+a.weight+" "+~~((a.size+1)/s)+"px "+a.font;var h=t.measureText(a.text+"m").width*s,i=a.size<<1;if(a.rotate){var j=Math.sin(a.rotate*p),k=Math.cos(a.rotate*p),l=h*k,m=h*j,n=i*k,o=i*j;h=Math.max(Math.abs(l+o),Math.abs(l-o))+31>>5<<5,i=~~Math.max(Math.abs(m+n),Math.abs(m-n))}else h=h+31>>5<<5;if(i>f&&(f=i),d+h>=q<<5&&(d=0,e+=f,f=0),e+i>=r)break;t.translate((d+(h>>1))/s,(e+(i>>1))/s),a.rotate&&t.rotate(a.rotate*p),t.fillText(a.text,0,0),a.padding&&(t.lineWidth=2*a.padding,t.strokeText(a.text,0,0)),t.restore(),a.width=h,a.height=i,a.xoff=d,a.yoff=e,a.x1=h>>1,a.y1=i>>1,a.x0=-a.x1,a.y0=-a.y1,a.hasText=!0,d+=h}for(var u=t.getImageData(0,0,(q<<5)/s,r/s).data,v=[];--c>=0;)if(a=b[c],a.hasText){for(var h=a.width,w=h>>5,i=a.y1-a.y0,x=0;i*w>x;x++)v[x]=0;if(d=a.xoff,null==d)return;e=a.yoff;for(var y=0,z=-1,A=0;i>A;A++){for(var x=0;h>x;x++){var B=w*A+(x>>5),C=u[(e+A)*(q<<5)+(d+x)<<2]?1<<31-x%32:0;v[B]|=C,y|=C}y?z=A:(a.y0++,i--,A--,e++)}a.y1=a.y0+z,a.sprite=v.slice(0,(a.y1-a.y0)*w)}}}function i(a,b,c){c>>=5;for(var d,e=a.sprite,f=a.width>>5,g=a.x-(f<<4),h=127&g,i=32-h,j=a.y1-a.y0,k=(a.y+a.y0)*c+(g>>5),l=0;j>l;l++){d=0;for(var m=0;f>=m;m++)if((d<<i|(f>m?(d=e[l*f+m])>>>h:0))&b[k+m])return!0;k+=c}return!1}function j(a,b){var c=a[0],d=a[1];b.x+b.x0<c.x&&(c.x=b.x+b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>d.x&&(d.x=b.x+b.x1),b.y+b.y1>d.y&&(d.y=b.y+b.y1)}function k(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function l(a){var b=a[0]/a[1];return function(a){return[b*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function m(a){var b=4,c=b*a[0]/a[1],d=0,e=0;return function(a){var f=0>a?-1:1;switch(Math.sqrt(1+4*f*a)-f&3){case 0:d+=c;break;case 1:e+=b;break;case 2:d-=c;break;default:e-=b}return[d,e]}}function n(a){for(var b=[],c=-1;++c<a;)b[c]=0;return b}var o,p=Math.PI/180,q=64,r=2048,s=1;"undefined"!=typeof document?(o=document.createElement("canvas"),o.width=1,o.height=1,s=Math.sqrt(o.getContext("2d").getImageData(0,0,1,1).data.length>>2),o.width=(q<<5)/s,o.height=r/s):o=new Canvas(q<<5,r);var t=o.getContext("2d"),u={archimedean:l,rectangular:m};t.fillStyle=t.strokeStyle="red",t.textAlign="center","object"==typeof module&&module.exports?module.exports=a:(d3.layout||(d3.layout={})).cloud=a}();